<script>
const API_BASE="https://aura-backend-mpvi.onrender.com";
const API=API_BASE+"/movies";
let allSeries=[];

document.addEventListener("DOMContentLoaded", () => {
  loadSeries();
});

async function loadSeries(){
  try{
    const res = await fetch(API);

    if(!res.ok){
      throw new Error("Server not responding");
    }

    const data = await res.json();

    if(!Array.isArray(data)){
      throw new Error("Invalid data");
    }

    allSeries = data;
    renderSeries(data);

  }catch(err){
    console.error("LOAD ERROR:", err);

    const row = document.getElementById("seriesRow");
    if(row){
      row.innerHTML =
        "<p style='padding:20px'>⚠️ السيرفر يتأخر حالياً... حاول بعد ثواني</p>";
    }
  }
}

function renderSeries(data){
  const row=document.getElementById("seriesRow");
  if(!row) return;

  row.innerHTML="";
  data.forEach(item=>{
    row.innerHTML+=`
      <div class="card" onclick="openSeries('${item._id}')">
        <img src="${item.image}">
      </div>`;
  });
}

function openSeries(id){
  const series=allSeries.find(s=>s._id===id);
  if(!series) return;

  const overlay=document.createElement("div");
  overlay.className="overlay";

  overlay.innerHTML=`
    <h2 style="text-align:center;text-shadow:0 0 20px #00bfff;">
      ${series.title}
    </h2>

    <div class="episodes-grid">
      ${
        series.episodes && series.episodes.length
        ? series.episodes.map((ep,index)=>`
            <div class="episode-card">
              <img src="${ep.image || series.image}">
              <div class="episode-number">الحلقة ${index+1}</div>
            </div>
          `).join("")
        : ""
      }
    </div>

    <div style="text-align:center">
      <button class="close-btn" onclick="this.closest('.overlay').remove()">
        ✖ إغلاق
      </button>
    </div>
  `;

  document.body.appendChild(overlay);
}
</script>
