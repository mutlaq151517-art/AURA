<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø³Ø§Ø¨ÙŠ - AURA</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#06121f,#0b1f38,#071a2f);
  color:white;
  padding-bottom:90px;
}

.header{
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  text-shadow:0 0 12px rgba(0,191,255,0.8);
}

.container{
  padding:30px 20px;
  text-align:center;
}

.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(15px);
  padding:30px;
  border-radius:20px;
  box-shadow:0 0 30px rgba(0,191,255,0.3);
}

/* Profiles */
.profiles-container{
  display:flex;
  justify-content:center;
  gap:15px;
  flex-wrap:wrap;
  margin-bottom:25px;
}

.profile-circle{
  width:75px;
  height:75px;
  border-radius:50%;
  background:linear-gradient(45deg,#00bfff,#008cff);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}

.profile-circle:hover{
  transform:scale(1.1);
  box-shadow:0 0 20px rgba(0,191,255,0.8);
}

.profile-add{
  background:rgba(255,255,255,0.1);
}

.active-profile{
  border:3px solid white;
}

/* Buttons */
button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:15px;
  background:linear-gradient(45deg,#00bfff,#008cff);
  color:white;
  cursor:pointer;
  font-size:14px;
}

/* Bottom Nav */
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:rgba(7,26,47,0.95);
  display:flex;
  justify-content:space-around;
  padding:12px 0;
  border-top:1px solid rgba(255,255,255,0.1);
}

.nav-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:12px;
  color:#ccc;
  cursor:pointer;
}

.nav-item.active{
  color:#00bfff;
}
</style>
</head>

<body>

<div class="header">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</div>

<div class="container">

  <!-- Profiles -->
  <div id="profilesSection"></div>

  <div class="card">
    <div id="userInfo"></div>
    <div id="actionButton"></div>
  </div>
</div>

<div class="bottom-nav">
  <div class="nav-item" onclick="window.location.href='index.html'">ğŸ <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
  <div class="nav-item" onclick="window.location.href='settings.html'">âš™ï¸<span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
  <div class="nav-item active">ğŸ‘¤<span>Ø§Ù„Ù…Ù„Ù</span></div>
</div>

<script>
const token = localStorage.getItem("token");
const API = "https://aura-backend-mpvi.onrender.com";

if(token){
  loadUser();
  loadProfiles();
}else{
  showLogin();
}

function loadUser(){
  fetch(API + "/me",{
    headers:{ Authorization: token }
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.username){
      document.getElementById("userInfo").innerHTML =
        "<h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ "+data.username+" ğŸ‘‘</h3>";

      document.getElementById("actionButton").innerHTML =
        "<button onclick='logout()'>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>";
    }else{
      showLogin();
    }
  })
  .catch(()=>showLogin());
}

function showLogin(){
  document.getElementById("userInfo").innerHTML =
    "<h3>Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</h3>";

  document.getElementById("actionButton").innerHTML =
    "<button onclick=\"window.location.href='login.html'\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>";
}

function logout(){
  localStorage.removeItem("token");
  localStorage.removeItem("profileId");
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  window.location.reload();
}

/* =========================
   Profiles Logic
========================= */

function loadProfiles(){
  fetch(API + "/profiles",{
    headers:{ Authorization: token }
  })
  .then(res=>res.json())
  .then(profiles=>{
    const section = document.getElementById("profilesSection");
    section.innerHTML = "<div class='profiles-container' id='profilesContainer'></div>";

    const container = document.getElementById("profilesContainer");

    const activeId = localStorage.getItem("profileId");

    profiles.forEach(p=>{
      container.innerHTML += `
        <div class="profile-circle ${activeId===p._id?'active-profile':''}"
             onclick="selectProfile('${p._id}')">
          ${p.name.charAt(0).toUpperCase()}
        </div>
      `;
    });

    if(profiles.length < 5){
      container.innerHTML += `
        <div class="profile-circle profile-add"
             onclick="createProfile()">
          +
        </div>
      `;
    }
  });
}

function selectProfile(id){
  localStorage.setItem("profileId",id);
  loadProfiles();
}

function createProfile(){
  const name = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù");
  if(!name) return;

  fetch(API + "/profiles",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization: token
    },
    body:JSON.stringify({name})
  })
  .then(()=>loadProfiles());
}
</script>

</body>
</html>
