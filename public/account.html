<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø³Ø§Ø¨ÙŠ - AURA</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#06121f,#0b1f38,#071a2f);
  color:white;
  padding-bottom:130px;
}

/* ===== Header ===== */
.header{
  padding:25px;
  text-align:center;
  font-size:24px;
  font-weight:bold;
  text-shadow:0 0 18px rgba(0,191,255,0.8);
}

/* ===== Container ===== */
.container{
  padding:30px 20px;
  text-align:center;
}

.card{
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(20px);
  padding:30px;
  border-radius:25px;
  box-shadow:0 15px 40px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.08);
}

/* ===== Profiles ===== */
.profiles-container{
  display:flex;
  justify-content:center;
  gap:25px;
  flex-wrap:wrap;
  margin-bottom:30px;
}

.profile-wrapper{
  position:relative;
}

.profile-circle{
  width:85px;
  height:85px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
  color:white;
}

.profile-circle:hover{
  transform:scale(1.12);
  box-shadow:0 0 25px rgba(0,191,255,0.6);
}

.profile-add{
  background:rgba(255,255,255,0.1);
}

.active-profile{
  border:4px solid #00bfff;
  box-shadow:0 0 25px rgba(0,191,255,0.8);
}

.profile-actions{
  position:absolute;
  top:-10px;
  right:-10px;
  display:flex;
  gap:6px;
}

.action-btn{
  width:24px;
  height:24px;
  border-radius:50%;
  background:black;
  color:white;
  font-size:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

/* ===== Buttons ===== */
button{
  width:100%;
  padding:14px;
  margin-top:18px;
  border:none;
  border-radius:20px;
  background:linear-gradient(45deg,#00bfff,#008cff);
  color:white;
  cursor:pointer;
  font-size:15px;
  box-shadow:0 0 20px rgba(0,191,255,0.5);
  transition:0.3s;
}

button:hover{
  transform:scale(1.05);
}

/* ===== Modern Glass Bottom Nav ===== */
.bottom-nav{
  position:fixed;
  bottom:25px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:420px;
  height:70px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(20px);
  border-radius:25px;
  display:flex;
  justify-content:space-around;
  align-items:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.1);
  z-index:999;
}

.nav-item{
  font-size:22px;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  cursor:pointer;
  transition:all 0.3s ease;
  color:white;
}

.nav-item:hover{
  background:rgba(0,191,255,0.2);
  transform:translateY(-5px);
}

.nav-item.active{
  background:#00bfff;
  box-shadow:0 0 20px rgba(0,191,255,0.7);
}
</style>
</head>

<body>

<div class="header">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</div>

<div class="container">
  <div id="profilesSection"></div>

  <div class="card">
    <div id="userInfo"></div>
    <div id="actionButton"></div>
  </div>
</div>

<!-- ===== Bottom Navigation ===== -->
<div class="bottom-nav">
  <div class="nav-item" id="navHome" onclick="window.location.href='index.html'">ğŸ </div>
  <div class="nav-item" id="navSettings" onclick="window.location.href='settings.html'">âš™ï¸</div>
  <div class="nav-item" id="navProfile">ğŸ‘¤</div>
</div>

<script>
const token = localStorage.getItem("token");
const API = "https://aura-backend-mpvi.onrender.com";

if(token){
  loadUser();
  loadProfiles();
}else{
  showLogin();
}

function loadUser(){
  fetch(API + "/me",{ headers:{ Authorization: token } })
  .then(res=>res.json())
  .then(data=>{
    if(data.username){
      document.getElementById("userInfo").innerHTML =
        "<h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ "+data.username+" ğŸ‘‘</h3>";
      document.getElementById("actionButton").innerHTML =
        "<button onclick='logout()'>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>";
    }else{
      showLogin();
    }
  })
  .catch(()=>showLogin());
}

function showLogin(){
  document.getElementById("userInfo").innerHTML =
    "<h3>Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</h3>";
  document.getElementById("actionButton").innerHTML =
    "<button onclick=\"window.location.href='login.html'\">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>";
}

function logout(){
  localStorage.removeItem("token");
  localStorage.removeItem("profileId");
  window.location.reload();
}

/* ===== Active Nav ===== */
function setActiveNav(){
  document.getElementById("navProfile").classList.add("active");
}
setActiveNav();

/* ===== Profiles (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ù…Ù†Ø·Ù‚Ùƒ) ===== */

function loadProfiles(){
  fetch(API + "/profiles",{ headers:{ Authorization: token }})
  .then(res=>res.json())
  .then(profiles=>{
    const section=document.getElementById("profilesSection");
    section.innerHTML="<div class='profiles-container' id='profilesContainer'></div>";
    const container=document.getElementById("profilesContainer");

    const activeId=localStorage.getItem("profileId");

    profiles.forEach(p=>{
      container.innerHTML+=`
        <div class="profile-wrapper">
          <div class="profile-actions">
            <div class="action-btn" onclick="editProfile('${p._id}')">âœï¸</div>
            <div class="action-btn" onclick="deleteProfile('${p._id}',${profiles.length})">ğŸ—‘</div>
          </div>
          <div class="profile-circle ${activeId===p._id?'active-profile':''}"
               style="background:${p.color || '#00bfff'}"
               onclick="selectProfile('${p._id}')">
            ${p.name.charAt(0).toUpperCase()}
          </div>
        </div>
      `;
    });

    if(profiles.length<5){
      container.innerHTML+=`
        <div class="profile-circle profile-add"
             onclick="createProfile()">+</div>
      `;
    }
  });
}

function selectProfile(id){
  localStorage.setItem("profileId",id);
  loadProfiles();
}

function createProfile(){
  const name=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:");
  if(!name) return;

  fetch(API+"/profiles",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:token
    },
    body:JSON.stringify({name})
  })
  .then(()=>loadProfiles());
}

function editProfile(id){
  const newName=prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
  if(!newName) return;

  fetch(API+"/profiles/"+id,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      Authorization:token
    },
    body:JSON.stringify({name:newName})
  })
  .then(()=>loadProfiles());
}

function deleteProfile(id,count){
  if(count<=1){
    alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¢Ø®Ø± Ù…Ù„Ù");
    return;
  }

  if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;

  fetch(API+"/profiles/"+id,{
    method:"DELETE",
    headers:{ Authorization:token }
  })
  .then(()=>loadProfiles());
}
</script>

</body>
</html>
